package isc.whu.defender;

import android.app.KeyguardManager;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.PowerManager;
import android.widget.Toast;

public class AlarmReceiver extends BroadcastReceiver {
	public static final String ALARM_ACTION = "myaction.alarm";
	private PowerManager pm;
	private PowerManager.WakeLock wakeLock;
	private KeyguardManager km;
	private KeyguardManager.KeyguardLock keyLock;

	@Override
	/**
	 * 接收到定时发送的广播
	 * 点亮屏幕，解锁键盘
	 */
	public void onReceive(Context context, Intent intent) {
		System.out.println("broadcast received: " + intent.getAction());

		/*
		 * 点亮屏幕 & 解锁键盘
		 */
		pm = (PowerManager) context.getSystemService(Context.POWER_SERVICE);
		wakeLock = pm.newWakeLock(PowerManager.SCREEN_DIM_WAKE_LOCK, "My Tag");
		km = (KeyguardManager) context
				.getSystemService(Context.KEYGUARD_SERVICE);
		keyLock = km.newKeyguardLock("key lock");

		if (intent.getAction().toString().equals(ALARM_ACTION)) {
			wakeLock.acquire(10 * 1000); // release wake lock after 10s
			keyLock.disableKeyguard(); // unlock keyboard
		}

	}

}
