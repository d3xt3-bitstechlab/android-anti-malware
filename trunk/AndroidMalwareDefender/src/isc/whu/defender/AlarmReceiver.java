package isc.whu.defender;

import android.app.KeyguardManager;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.PowerManager;

public class AlarmReceiver extends BroadcastReceiver {
	public static final String ALARM_ACTION = "myaction.alarm";
	private PowerManager pm;
	private PowerManager.WakeLock wakeLock;
	private KeyguardManager km;
	private KeyguardManager.KeyguardLock keyLock;
	private Context context; // context of this receiver

	@Override
	/**
	 * 接收到定时发送的广播
	 * 点亮屏幕，解锁键盘
	 */
	public void onReceive(Context context, Intent intent) {
		this.context = context;
		System.out.println("broadcast received: " + intent.getAction());
		
		/*
		 * 点亮屏幕 & 解锁键盘
		 */
		//lightScreen(10);
		//unlockKeyboard();
	}
	
	
	private void lightScreen(int second) {
		pm = (PowerManager) context.getSystemService(Context.POWER_SERVICE);
		wakeLock = pm.newWakeLock(PowerManager.SCREEN_DIM_WAKE_LOCK, "My Tag");
		wakeLock.acquire(second * 1000);
	}
	
	private void unlockKeyboard() {
		km = (KeyguardManager) context.getSystemService(Context.KEYGUARD_SERVICE);
		keyLock = km.newKeyguardLock("key lock");
		keyLock.disableKeyguard();
	}

}
