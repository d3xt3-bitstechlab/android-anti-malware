package isc.whu.defender;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import android.app.Activity;
import android.content.pm.ApplicationInfo;
import android.content.pm.PackageInfo;
import android.graphics.drawable.Drawable;
import android.os.Bundle;

public class TrafficMonitor extends Activity {
	private ArrayList<AppInfo> appinfo = new ArrayList<AppInfo>();

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		// TODO Auto-generated method stub
		super.onCreate(savedInstanceState);

		getInstalledAppInfo(false);

		outputAppInfo();
	}

	/**
	 * 获得已安装应用程序的基本信息
	 * 
	 * @param getSysApp
	 *            * 是否包括系统应用，即/system/app中的应用程序
	 * @return 包含多个应用程序的信息的表
	 */
	private ArrayList<AppInfo> getInstalledAppInfo(boolean getSysApp) {
		List<PackageInfo> packs = getPackageManager().getInstalledPackages(0);

		Iterator<PackageInfo> it = packs.iterator();
		PackageInfo p;
		while (it.hasNext()) {
			AppInfo app = new AppInfo();
			p = it.next();
			// if (p.applicationInfo.uid <= 10000)
			if ((!getSysApp)
					&& (p.applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) > 0)
				continue;

			app.appName = p.applicationInfo.loadLabel(getPackageManager())
					.toString();
			app.packageName = p.packageName;
			app.uid = p.applicationInfo.uid;
			app.versionCode = p.versionCode;
			app.appIcon = p.applicationInfo.loadIcon(getPackageManager());
			appinfo.add(app);

		}

		return appinfo;
	}

	/**
	 * 输出应用的信息
	 */
	private void outputAppInfo() {
		Iterator<AppInfo> it = appinfo.iterator();
		AppInfo tmp;
		while (it.hasNext()) {
			tmp = it.next();
			System.out.println(tmp.uid + ": " + tmp.appName);
		}
	}

}

/**
 * 用来存储应用的基本信息
 * 
 * @author Shao
 * 
 */
class AppInfo {
	public String appName;
	public String packageName;
	public long uid;
	public int versionCode;
	public Drawable appIcon;
}